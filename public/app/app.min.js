var app = angular.module('pomodoro', ['timerCtrl', 'settingCtrl', 'taskCtrl', 'ui.router', 'LocalStorageModule'])

  // Directives
  .directive('timer', function(){
      return {
        restrict: 'A',
        templateUrl: '/app/views/timer.html',
        controller: 'timerCtrl'
      };
  })
  .directive('settings', function(){
      return {
        restrict: 'A',
        templateUrl: '/app/views/settings.html',
        controller: 'settingCtrl'
      };
  })
  .directive('tasks', function(){
      return {
        restrict: 'A',
        templateUrl: '/app/views/tasks.html',
        controller: 'taskCtrl'
      };
  })

  // Filter to format minutes and seconds
  .filter('numberFixedLen', function () {
        return function (n, len) {
            var num = parseInt(n, 10);
            len = parseInt(len, 10);
            if (isNaN(num) || isNaN(len)) {
                return n;
            }
            num = '' + num;
            while (num.length < len) {
                num = '0' + num;
            }
            return num;
        };
    })

    // Routing timers
    .config(["$stateProvider", "$urlRouterProvider", "localStorageServiceProvider", function($stateProvider, $urlRouterProvider, localStorageServiceProvider) {
      $urlRouterProvider.otherwise('/pomodoro');

      $stateProvider

        .state('pomodoro', {
          name: 'pomodoro',
          url: '/pomodoro',
          templateUrl: '/app/views/timers/pomodoro.html'
        })

        .state('shortpause', {
          name: 'shortPause',
          url: '/shortpause',
          templateUrl: '/app/views/timers/shortpause.html'
        })

        .state('longpause', {
          name: 'longPause',
          url: '/longpause',
          templateUrl: '/app/views/timers/longpause.html'
        });

        localStorageServiceProvider
          .setPrefix('bromodoro')
          .setStorageType('localStorage');
    }]);
